<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
    <title>showonne</title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/tomorrow-night.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
    <header>
    <span class="banner"><a href="/">showonne</a></span>
    <span class="menu">Menu</span>
    <ul class="menu_list hide">
        
            <li><a href="/" >Home</a></li>
        
            <li><a href="/archives" >Archives</a></li>
        
            <li><a href="/tags" >Tags</a></li>
        
            <li><a href="/links" >Links</a></li>
        
            <li><a href="/about" >About</a></li>
        
    </ul>
</header>
    <div class="main">
        
    <article>
    <h1 class='post-title'>
        <span>Express基础</span>
    </h1>
    <section class='post-content'>
        
            
        
        <p>自己从Express官网API做的一些摘要。</p>
<p>安装express4.X <code>$ npm install -g express-generator</code></p>
<span id="more"></span>
<p>express.static(root, [options]);<br><code>express.static</code>现在是express中唯一一个内置的中间件,用来为应用提供静态资源服务.</p>
<pre><code>//指定public为静态资源目录
app.use(express.static(path.join(__dirname, &apos;public&apos;)));
</code></pre><h2 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h2><p>app.set(name,value)：用来设置项目配置，常用的有:</p>
<pre><code>//views文件夹
app.set(&apos;views&apos;, path.join(__dirname, &apos;views&apos;));
//视图渲染引擎
app.set(&apos;view engine&apos;, &apos;jade&apos;);
</code></pre><p><strong>app.use([path,]function[,function…])</strong>:大量的中间件可以放在<code>path</code>中，如果<code>path</code>没有指定的话，默认是<code>&quot;/&quot;</code>。</p>
<p>另外如果path的值是<code>&quot;/&quot;</code>时，这个路由会匹配所有路径，比如<code>&quot;/user&quot;,&quot;/user/show&quot;,&quot;/user/show/info&quot;</code>等等…因此express默认生成的项目中使用app.use()来捕获404异常.而且因为中间件的函数也都是写在path中，因此这些中间件的函数无论在哪个请求路径下都能执行。</p>
<pre><code>//将app.use写在路由规则的最后，当前面的路由无一能匹配时(传说中的404 NOT FOUND)，路由会经过app.use(function()&#123;&#125;),使用function()作为异常处理函数。
app.use(function(req, res, next) &#123;
  var err = new Error(&apos;Not Found&apos;);
  err.status = 404;
  next(err);
&#125;);
</code></pre><p><strong>中间件是顺序执行的</strong>，因此include和use中间件的顺序很重要(可能存在依赖关系).</p>
<p>Express中路由的路径可以是字符串路径，路径模式，正则表达式或者数组。</p>
<pre><code>// GET /style.css etc
app.use(express.static(__dirname + &apos;/public&apos;));
//也可同时指定多个，请求资源时按顺序请求(最好给public优先权)
app.use(express.static(__dirname + &apos;/public&apos;));
app.use(express.static(__dirname + &apos;/files&apos;));
app.use(express.static(__dirname + &apos;/uploads&apos;));
</code></pre><h2 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h2><p>request对象代表HTTP请求，含有包括请求字符串，参数，请求体，请求头等等。<strong>在Express4中，req.files默认在req中不可用</strong>，因此如果想进行上传文件的功能，要使用例如<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/multer" title="multer">multer</a>这样的中间件。</p>
<p><strong>req.body</strong>:包含提交数据的键值对，默认是<code>undefined</code>，当你使用body-parsing中间件时它就被构建了。</p>
<p><strong>req.params</strong>：一个包含映射路由参数的对象。例如，如果使用了路由<code>/user/:name</code>，则<code>name</code>属性<code>req.params.name</code>可用，该对象默认为<code>&#123;&#125;</code>.</p>
<p><strong>req.query</strong>：包括query string(url中?后的部分)参数的对象，默认为空对象<code>&#123;&#125;</code>。</p>
<p><strong>req.cookie</strong>:当使用<code>cookie-parser</code>时，它是一个含有cookies的对象，若req中不包含cookies，默认为空对象<code>&#123;&#125;</code>.</p>
<p><strong>req.get</strong>：返回指定的请求头信息。</p>
<pre><code>req.get(&apos;Content-Type&apos;);
// =&gt; &quot;text/plain&quot;
</code></pre><p>req.ip,req.hostname,req.protocol可以获取请求的ip,主机名,协议</p>
<h2 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h2><p>response代表应用收到请求后返回的相应的HTTP相应。</p>
<p>res.download(path[,filename][,fn]):下载文件.</p>
<p>res.end():结束响应进程。</p>
<p>res.format(object):根据不同的请求头信息(也可以通过MIME TYPE)返回不同数据。</p>
<pre><code>res.format(&#123;
  &apos;text/plain&apos;: function()&#123;
    res.send(&apos;hey&apos;);
  &#125;,

  &apos;text/html&apos;: function()&#123;
    res.send(&apos;&lt;p&gt;hey&lt;/p&gt;&apos;);
  &#125;,

  &apos;application/json&apos;: function()&#123;
    res.send(&#123; message: &apos;hey&apos; &#125;);
  &#125;,

  &apos;default&apos;: function() &#123;
    // log the request and respond with 406
    res.status(406).send(&apos;Not Acceptable&apos;);
  &#125;
&#125;);
</code></pre><p>or</p>
<pre><code>res.format(&#123;
  text: function()&#123;
    res.send(&apos;hey&apos;);
  &#125;,

  html: function()&#123;
    res.send(&apos;&lt;p&gt;hey&lt;/p&gt;&apos;);
  &#125;,

  json: function()&#123;
    res.send(&#123; message: &apos;hey&apos; &#125;);
  &#125;
&#125;);
</code></pre><p><strong>res.json</strong>:返回JSON响应.<br><strong>res.redirect</strong>:页面重定向.<br><strong>res.render(view[,locals][,callback])</strong>:渲染视图.<br><strong>res.send([body])</strong>.发送响应，<code>[body]</code>可以是<code>Buffer</code>，<code>Object</code>，<code>String</code>，<code>Array</code>.<br>res.set(field [, value]):设置响应头信息.</p>
<pre><code>res.set(&apos;Content-Type&apos;, &apos;text/plain&apos;);

res.set(&#123;
  &apos;Content-Type&apos;: &apos;text/plain&apos;,
  &apos;Content-Length&apos;: &apos;123&apos;,
  &apos;ETag&apos;: &apos;12345&apos;
&#125;)
</code></pre><p>res.sendFile(path[,options][,fn]):</p>
<pre><code>app.get(&apos;/file/:name&apos;, function (req, res, next) &#123;

  var options = &#123;
    root: __dirname + &apos;/public/&apos;,
    dotfiles: &apos;deny&apos;,
    headers: &#123;
        &apos;x-timestamp&apos;: Date.now(),
        &apos;x-sent&apos;: true
    &#125;
  &#125;;

  var fileName = req.params.name;
  res.sendFile(fileName, options, function (err) &#123;
    if (err) &#123;
      console.log(err);
      res.status(err.status).end();
    &#125;
    else &#123;
      console.log(&apos;Sent:&apos;, fileName);
    &#125;
  &#125;);

&#125;)
</code></pre><p>res.sendStatus: 设置响应HTTP状态码并且返回对应字符串信息。</p>
<p>res.sendStatus(200); // equivalent to res.status(200).send(‘OK’);<br>res.sendStatus(404); // equivalent to res.status(404).send(‘Not Found’);</p>

    </section>
    
        <section id="comments">
        
        </section>
    
</article>

    </div>
    <button class="feedback-btn" data-feedbackok-trigger>Hello~ 🥰</button>
    <footer>
    <div class="info"><span>Powered By <a href="https://hexo.io/" target="blank">Hexo</a></span>&nbsp;&nbsp;&nbsp;&nbsp;<span>Theme by <a href="https://github.com/showonne/hexo_showonne" target="blank">Showonne</a></span></div>
</footer>
    <script
        src="https://cdn.feedbackok.com/widget.js"
        data-pid="0m524p3"
        async
        defer
    ></script>
    
<script src="/js/index.js"></script>

</body>
</html>
