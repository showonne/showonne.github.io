<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
    <title>showonne</title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/tomorrow-night.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
    <header>
    <span class="banner"><a href="/">showonne</a></span>
    <span class="menu">Menu</span>
    <ul class="menu_list hide">
        
            <li><a href="/" >Home</a></li>
        
            <li><a href="/archives" >Archives</a></li>
        
            <li><a href="/tags" >Tags</a></li>
        
            <li><a href="/links" >Links</a></li>
        
            <li><a href="/about" >About</a></li>
        
    </ul>
</header>
    <div class="main">
        
    <article>
    <h1 class='post-title'>
        <span>ExpressåŸºç¡€</span>
    </h1>
    <section class='post-content'>
        
            
        
        <p>è‡ªå·±ä»Expresså®˜ç½‘APIåšçš„ä¸€äº›æ‘˜è¦ã€‚</p>
<p>å®‰è£…express4.X <code>$ npm install -g express-generator</code></p>
<span id="more"></span>
<p>express.static(root, [options]);<br><code>express.static</code>ç°åœ¨æ˜¯expressä¸­å”¯ä¸€ä¸€ä¸ªå†…ç½®çš„ä¸­é—´ä»¶,ç”¨æ¥ä¸ºåº”ç”¨æä¾›é™æ€èµ„æºæœåŠ¡.</p>
<pre><code>//æŒ‡å®špublicä¸ºé™æ€èµ„æºç›®å½•
app.use(express.static(path.join(__dirname, &apos;public&apos;)));
</code></pre><h2 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h2><p>app.set(name,value)ï¼šç”¨æ¥è®¾ç½®é¡¹ç›®é…ç½®ï¼Œå¸¸ç”¨çš„æœ‰:</p>
<pre><code>//viewsæ–‡ä»¶å¤¹
app.set(&apos;views&apos;, path.join(__dirname, &apos;views&apos;));
//è§†å›¾æ¸²æŸ“å¼•æ“
app.set(&apos;view engine&apos;, &apos;jade&apos;);
</code></pre><p><strong>app.use([path,]function[,functionâ€¦])</strong>:å¤§é‡çš„ä¸­é—´ä»¶å¯ä»¥æ”¾åœ¨<code>path</code>ä¸­ï¼Œå¦‚æœ<code>path</code>æ²¡æœ‰æŒ‡å®šçš„è¯ï¼Œé»˜è®¤æ˜¯<code>&quot;/&quot;</code>ã€‚</p>
<p>å¦å¤–å¦‚æœpathçš„å€¼æ˜¯<code>&quot;/&quot;</code>æ—¶ï¼Œè¿™ä¸ªè·¯ç”±ä¼šåŒ¹é…æ‰€æœ‰è·¯å¾„ï¼Œæ¯”å¦‚<code>&quot;/user&quot;,&quot;/user/show&quot;,&quot;/user/show/info&quot;</code>ç­‰ç­‰â€¦å› æ­¤expressé»˜è®¤ç”Ÿæˆçš„é¡¹ç›®ä¸­ä½¿ç”¨app.use()æ¥æ•è·404å¼‚å¸¸.è€Œä¸”å› ä¸ºä¸­é—´ä»¶çš„å‡½æ•°ä¹Ÿéƒ½æ˜¯å†™åœ¨pathä¸­ï¼Œå› æ­¤è¿™äº›ä¸­é—´ä»¶çš„å‡½æ•°æ— è®ºåœ¨å“ªä¸ªè¯·æ±‚è·¯å¾„ä¸‹éƒ½èƒ½æ‰§è¡Œã€‚</p>
<pre><code>//å°†app.useå†™åœ¨è·¯ç”±è§„åˆ™çš„æœ€åï¼Œå½“å‰é¢çš„è·¯ç”±æ— ä¸€èƒ½åŒ¹é…æ—¶(ä¼ è¯´ä¸­çš„404 NOT FOUND)ï¼Œè·¯ç”±ä¼šç»è¿‡app.use(function()&#123;&#125;),ä½¿ç”¨function()ä½œä¸ºå¼‚å¸¸å¤„ç†å‡½æ•°ã€‚
app.use(function(req, res, next) &#123;
  var err = new Error(&apos;Not Found&apos;);
  err.status = 404;
  next(err);
&#125;);
</code></pre><p><strong>ä¸­é—´ä»¶æ˜¯é¡ºåºæ‰§è¡Œçš„</strong>ï¼Œå› æ­¤includeå’Œuseä¸­é—´ä»¶çš„é¡ºåºå¾ˆé‡è¦(å¯èƒ½å­˜åœ¨ä¾èµ–å…³ç³»).</p>
<p>Expressä¸­è·¯ç”±çš„è·¯å¾„å¯ä»¥æ˜¯å­—ç¬¦ä¸²è·¯å¾„ï¼Œè·¯å¾„æ¨¡å¼ï¼Œæ­£åˆ™è¡¨è¾¾å¼æˆ–è€…æ•°ç»„ã€‚</p>
<pre><code>// GET /style.css etc
app.use(express.static(__dirname + &apos;/public&apos;));
//ä¹Ÿå¯åŒæ—¶æŒ‡å®šå¤šä¸ªï¼Œè¯·æ±‚èµ„æºæ—¶æŒ‰é¡ºåºè¯·æ±‚(æœ€å¥½ç»™publicä¼˜å…ˆæƒ)
app.use(express.static(__dirname + &apos;/public&apos;));
app.use(express.static(__dirname + &apos;/files&apos;));
app.use(express.static(__dirname + &apos;/uploads&apos;));
</code></pre><h2 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h2><p>requestå¯¹è±¡ä»£è¡¨HTTPè¯·æ±‚ï¼Œå«æœ‰åŒ…æ‹¬è¯·æ±‚å­—ç¬¦ä¸²ï¼Œå‚æ•°ï¼Œè¯·æ±‚ä½“ï¼Œè¯·æ±‚å¤´ç­‰ç­‰ã€‚<strong>åœ¨Express4ä¸­ï¼Œreq.filesé»˜è®¤åœ¨reqä¸­ä¸å¯ç”¨</strong>ï¼Œå› æ­¤å¦‚æœæƒ³è¿›è¡Œä¸Šä¼ æ–‡ä»¶çš„åŠŸèƒ½ï¼Œè¦ä½¿ç”¨ä¾‹å¦‚<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/multer" title="multer">multer</a>è¿™æ ·çš„ä¸­é—´ä»¶ã€‚</p>
<p><strong>req.body</strong>:åŒ…å«æäº¤æ•°æ®çš„é”®å€¼å¯¹ï¼Œé»˜è®¤æ˜¯<code>undefined</code>ï¼Œå½“ä½ ä½¿ç”¨body-parsingä¸­é—´ä»¶æ—¶å®ƒå°±è¢«æ„å»ºäº†ã€‚</p>
<p><strong>req.params</strong>ï¼šä¸€ä¸ªåŒ…å«æ˜ å°„è·¯ç”±å‚æ•°çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨äº†è·¯ç”±<code>/user/:name</code>ï¼Œåˆ™<code>name</code>å±æ€§<code>req.params.name</code>å¯ç”¨ï¼Œè¯¥å¯¹è±¡é»˜è®¤ä¸º<code>&#123;&#125;</code>.</p>
<p><strong>req.query</strong>ï¼šåŒ…æ‹¬query string(urlä¸­?åçš„éƒ¨åˆ†)å‚æ•°çš„å¯¹è±¡ï¼Œé»˜è®¤ä¸ºç©ºå¯¹è±¡<code>&#123;&#125;</code>ã€‚</p>
<p><strong>req.cookie</strong>:å½“ä½¿ç”¨<code>cookie-parser</code>æ—¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªå«æœ‰cookiesçš„å¯¹è±¡ï¼Œè‹¥reqä¸­ä¸åŒ…å«cookiesï¼Œé»˜è®¤ä¸ºç©ºå¯¹è±¡<code>&#123;&#125;</code>.</p>
<p><strong>req.get</strong>ï¼šè¿”å›æŒ‡å®šçš„è¯·æ±‚å¤´ä¿¡æ¯ã€‚</p>
<pre><code>req.get(&apos;Content-Type&apos;);
// =&gt; &quot;text/plain&quot;
</code></pre><p>req.ip,req.hostname,req.protocolå¯ä»¥è·å–è¯·æ±‚çš„ip,ä¸»æœºå,åè®®</p>
<h2 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h2><p>responseä»£è¡¨åº”ç”¨æ”¶åˆ°è¯·æ±‚åè¿”å›çš„ç›¸åº”çš„HTTPç›¸åº”ã€‚</p>
<p>res.download(path[,filename][,fn]):ä¸‹è½½æ–‡ä»¶.</p>
<p>res.end():ç»“æŸå“åº”è¿›ç¨‹ã€‚</p>
<p>res.format(object):æ ¹æ®ä¸åŒçš„è¯·æ±‚å¤´ä¿¡æ¯(ä¹Ÿå¯ä»¥é€šè¿‡MIME TYPE)è¿”å›ä¸åŒæ•°æ®ã€‚</p>
<pre><code>res.format(&#123;
  &apos;text/plain&apos;: function()&#123;
    res.send(&apos;hey&apos;);
  &#125;,

  &apos;text/html&apos;: function()&#123;
    res.send(&apos;&lt;p&gt;hey&lt;/p&gt;&apos;);
  &#125;,

  &apos;application/json&apos;: function()&#123;
    res.send(&#123; message: &apos;hey&apos; &#125;);
  &#125;,

  &apos;default&apos;: function() &#123;
    // log the request and respond with 406
    res.status(406).send(&apos;Not Acceptable&apos;);
  &#125;
&#125;);
</code></pre><p>or</p>
<pre><code>res.format(&#123;
  text: function()&#123;
    res.send(&apos;hey&apos;);
  &#125;,

  html: function()&#123;
    res.send(&apos;&lt;p&gt;hey&lt;/p&gt;&apos;);
  &#125;,

  json: function()&#123;
    res.send(&#123; message: &apos;hey&apos; &#125;);
  &#125;
&#125;);
</code></pre><p><strong>res.json</strong>:è¿”å›JSONå“åº”.<br><strong>res.redirect</strong>:é¡µé¢é‡å®šå‘.<br><strong>res.render(view[,locals][,callback])</strong>:æ¸²æŸ“è§†å›¾.<br><strong>res.send([body])</strong>.å‘é€å“åº”ï¼Œ<code>[body]</code>å¯ä»¥æ˜¯<code>Buffer</code>ï¼Œ<code>Object</code>ï¼Œ<code>String</code>ï¼Œ<code>Array</code>.<br>res.set(field [, value]):è®¾ç½®å“åº”å¤´ä¿¡æ¯.</p>
<pre><code>res.set(&apos;Content-Type&apos;, &apos;text/plain&apos;);

res.set(&#123;
  &apos;Content-Type&apos;: &apos;text/plain&apos;,
  &apos;Content-Length&apos;: &apos;123&apos;,
  &apos;ETag&apos;: &apos;12345&apos;
&#125;)
</code></pre><p>res.sendFile(path[,options][,fn]):</p>
<pre><code>app.get(&apos;/file/:name&apos;, function (req, res, next) &#123;

  var options = &#123;
    root: __dirname + &apos;/public/&apos;,
    dotfiles: &apos;deny&apos;,
    headers: &#123;
        &apos;x-timestamp&apos;: Date.now(),
        &apos;x-sent&apos;: true
    &#125;
  &#125;;

  var fileName = req.params.name;
  res.sendFile(fileName, options, function (err) &#123;
    if (err) &#123;
      console.log(err);
      res.status(err.status).end();
    &#125;
    else &#123;
      console.log(&apos;Sent:&apos;, fileName);
    &#125;
  &#125;);

&#125;)
</code></pre><p>res.sendStatus: è®¾ç½®å“åº”HTTPçŠ¶æ€ç å¹¶ä¸”è¿”å›å¯¹åº”å­—ç¬¦ä¸²ä¿¡æ¯ã€‚</p>
<p>res.sendStatus(200); // equivalent to res.status(200).send(â€˜OKâ€™);<br>res.sendStatus(404); // equivalent to res.status(404).send(â€˜Not Foundâ€™);</p>

    </section>
    
        <section id="comments">
        
        </section>
    
</article>

    </div>
    <button class="feedback-btn" data-feedbackok-trigger>Hello~ ğŸ¥°</button>
    <footer>
    <div class="info"><span>Powered By <a href="https://hexo.io/" target="blank">Hexo</a></span>&nbsp;&nbsp;&nbsp;&nbsp;<span>Theme by <a href="https://github.com/showonne/hexo_showonne" target="blank">Showonne</a></span></div>
</footer>
    <script
        src="https://cdn.feedbackok.com/widget.js"
        data-pid="0m524p3"
        async
        defer
    ></script>
    
<script src="/js/index.js"></script>

</body>
</html>
