<!doctype html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Hexo</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/tomorrow-night.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
    <header>
    <span class="banner"><a href="/">Hexo</a></span>
    <span class="menu">Menu</span>
    <ul class="menu_list hide">
        
            <li><a href="/">Home</a></li>
        
            <li><a href="/archives">Archives</a></li>
        
            <li><a href="/tags">Tags</a></li>
        
            <li><a href="/links">Links</a></li>
        
            <li><a href="/about">About</a></li>
        
    </ul>
</header>
    <div class="main">
        
    <article>
    <h1 class="post-title">
        <span>CORSè¯·æ±‚å¤´&amp;&amp;å“åº”å¤´æ¦‚è§ˆ</span>
    </h1>
    <section class="post-content">
        
            
        
        <p>æœ€è¿‘é¡¹ç›®ä¸­é‡åˆ°äº†è·¨åŸŸä¼ Cookieçš„é—®é¢˜ï¼Œåœ¨ä¹‹å‰å¯¹äºCORSçš„å“åº”å¤´åªæ¥è§¦è¿‡<code>Access-Control-Allow-Origin</code>ï¼Œå…¶å®é™¤æ­¤ä¹‹å¤–è¿˜æœ‰å¾ˆå¤šè·¨åŸŸç›¸å…³çš„è¯·æ±‚å¤´å’Œå“åº”å¤´ï¼Œåœ¨è¿™æ•´ç†ä¸€ä¸‹ã€‚</p>
<a id="more"></a>
<p>æ–‡ä¸­çš„ä¾‹å­ä¸€å…±æ¶‰åŠä¸¤ä¸ªå·¥ç¨‹ï¼Œä¸€ä¸ª <code>cors-client</code> æœåŠ¡åœ¨æœ¬åœ° 8080 ç«¯å£ï¼Œä¸€ä¸ª <code>cors-server</code> åœ¨æœ¬åœ° 3000 ç«¯å£ï¼Œåˆ†åˆ«ç”¨æ¥å‘é€è¯·æ±‚å’Œå¤„ç†è¯·æ±‚ã€‚HTTPè¯·æ±‚åº“ä½¿ç”¨<code>axios</code>ï¼ŒæœåŠ¡æ˜¯<code>express</code>æ­å»ºçš„ç®€å•æœåŠ¡å™¨ã€‚</p>
<h2 id="Access-Control-Allow-Origin"><a href="#Access-Control-Allow-Origin" class="headerlink" title="Access-Control-Allow-Origin"></a>Access-Control-Allow-Origin</h2><p>è¿™æ˜¯æœ€å¸¸è§çš„å“åº”å¤´ï¼Œè¡¨ç¤ºè¯·æ±‚çš„èµ„æºèƒ½å…±äº«ç»™å“ªäº›åŸŸã€‚åŒæºå®‰å…¨ç­–ç•¥é»˜è®¤é˜»æ­¢è·¨åŸŸè·å–èµ„æºã€‚å¦‚æœç›´æ¥å‘èµ·è·¨åŸŸè¯·æ±‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; code &#125; = <span class="keyword">await</span> axios.post(<span class="string">'http://localhost:3000/api/demo'</span>);</span><br></pre></td></tr></table></figure>
<p>æµè§ˆå™¨ä¼šæŠ¥è·¨åŸŸé”™è¯¯ï¼š</p>
<p><img src="https://s2.ax1x.com/2019/09/10/naljFH.png" alt></p>
<p>å› ä¸ºæ²¡æœ‰ <code>Access-Control-Allow-Origin</code> å“åº”å¤´ï¼Œå¦‚æœåœ¨æœåŠ¡ç«¯å…è®¸æœ¬åœ° 8000 ç«¯å£è·¨åŸŸè®¿é—®ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/api/demo'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.header(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'http://localhost:8080'</span>)</span><br><span class="line">  res.json(&#123;<span class="attr">code</span>: <span class="number">200</span>, <span class="attr">message</span>: <span class="string">'Hello~'</span>&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°±èƒ½é¡ºåˆ©è®¿é—®åˆ°èµ„æºäº† ï¼ŒåŒæ—¶å¯ä»¥çœ‹åˆ° Response Headers é‡Œçš„  <code>Access-Control-Allow-Origin</code>ï¼Œå°±æ˜¯æˆ‘ä»¬ client çš„åŸŸï¼š</p>
<p><img src="https://s2.ax1x.com/2019/09/10/na1im8.png" alt></p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è®¾ç½®æˆ <code>*</code> è¡¨ç¤ºèµ„æºå¯ä»¥è¢«ä»»ä½•åŸŸå…±äº«ã€‚</p>
<h2 id="Access-Control-Allow-Headers"><a href="#Access-Control-Allow-Headers" class="headerlink" title="Access-Control-Allow-Headers"></a>Access-Control-Allow-Headers</h2><p>è¿™ä¸ªè¯·æ±‚å¤´ç”¨äºå“åº”<strong>é¢„è¯·æ±‚</strong>ï¼Œå‘ŠçŸ¥å®é™…çš„è¯·æ±‚ä¸­å¯ä»¥ä½¿ç”¨å“ªäº› HTTP å¤´ã€‚ä¸è¿‡é¢„è¯·æ±‚åªæœ‰åœ¨å¤æ‚è¯·æ±‚æ—¶æ‰ä¼šå‘ï¼Œå¤æ‚è¯·æ±‚ä¸ç®€å•è¯·æ±‚ç›¸å¯¹ï¼Œç®€å•è¯·æ±‚æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ol>
<li><p>request header æ˜¯ç®€å•çš„è¯·æ±‚å¤´ï¼š</p>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Type<br>ç­‰ç­‰éè‡ªå®šä¹‰çš„è¯·æ±‚å¤´</li>
</ul>
</li>
<li><p>request method æ˜¯ä¸‹é¢çš„è¯·æ±‚ç±»å‹ï¼š</p>
<ul>
<li>HEAD</li>
<li>GET</li>
<li>POST</li>
</ul>
</li>
<li><p>Content-Type åªé™ä¸‰ä¸ªå€¼ï¼š</p>
<ul>
<li>application/x-www-form-urlencodedã€multipart/form-dataã€text/plain</li>
</ul>
</li>
</ol>
<p>å¦åˆ™å°±æ˜¯å¤æ‚è¯·æ±‚, (å®é™…ä¸Šxhrç»‘å®šäº†<code>onloadStart</code>äº‹ä»¶ï¼Œbodyæœ‰å€¼ç­‰ä¹Ÿå‘é€äº† options è¯·æ±‚ï¼‰ã€‚æ¯”å¦‚æˆ‘ä»¬é€šå¸¸ä¼šåœ¨è¯·æ±‚å¤´é‡ŒåŠ ä¸Š <code>x-requested-with</code>ï¼Œç”¨æ¥åŒºåˆ†è¯·æ±‚æ˜¯å¦æ˜¯ajaxè¯·æ±‚ï¼Œè¿™æ—¶è¯·æ±‚å°±å˜æˆäº†ä¸€ä¸ªå¤æ‚è¯·æ±‚ï¼Œåˆ·æ–°æµè§ˆå™¨ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨é‡Œå‘ç°æµè§ˆå™¨æ²¡æœ‰ç«‹åˆ»å‘å‡ºpostè¯·æ±‚ï¼Œè€Œæ˜¯å‘é€äº†ä¸€ä¸ªoptionsè¯·æ±‚ï¼š</p>
<p><img src="https://s2.ax1x.com/2019/09/11/na3CC9.png" alt></p>
<p>å¯ä»¥çœ‹åˆ° request headers é‡Œæœ‰ <code>Origin</code>ï¼Œ<code>Access-Control-Request-Method</code>, <code>Access-Control-Request-Headers</code>ï¼Œæœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å®¢æˆ·ç«¯æƒ³è¦å‘èµ·çš„å¤æ‚è¯·æ±‚çš„ä¿¡æ¯æ ¡éªŒï¼Œè¿›è€Œå†³å®šæ˜¯å¦å…è®¸çœŸæ­£çš„è¯·æ±‚å‘é€åˆ°æœåŠ¡ç«¯ã€‚å…¶ä¸­ï¼š</p>
<ul>
<li><code>Origin</code> è¡¨ç¤ºè¯·æ±‚æ˜¯ä»ä»€ä¹ˆåŸŸå‘èµ·çš„</li>
<li><code>Access-Control-Request-Headers</code>å‘ŠçŸ¥æ­£å¼è¯·æ±‚ä¼šç”¨å“ªäº›è¯·æ±‚å¤´</li>
<li><code>Access-Control-Request-Method</code> å‘ŠçŸ¥æœåŠ¡å™¨æ­£å¼è¯·æ±‚çš„æ–¹æ³•</li>
</ul>
<p><code>Access-Control-Allow-Headers</code> å‘ŠçŸ¥æ­£å¼è¯·æ±‚ä¸­å…è®¸æºå¸¦çš„è¯·æ±‚å¤´ï¼Œç®€å•çš„è¯·æ±‚å¤´ï¼Œå¦‚ <code>Accept</code>ã€<code>Accept-Language</code>ã€<code>Content-Language</code>ã€<code>Content-Type</code> ï¼ˆåªé™äºè§£æåçš„å€¼ä¸º <code>application/x-www-form-urlencoded</code>ã€<code>multipart/form-data</code> æˆ– <code>text/plain</code> ä¸‰ç§MIMEç±»å‹ï¼ˆä¸åŒ…æ‹¬å‚æ•°ï¼‰ï¼‰æ˜¯å§‹ç»ˆè¢«æ”¯æŒçš„ï¼Œä¸éœ€è¦ç‰¹æ„åˆ—å‡ºã€‚å¦‚æœå®¢æˆ·ç«¯å‘é€äº†å…¶ä»– <code>Access-Control-Allow-Headers</code> ä¸­æ²¡æœ‰åˆ—å‡ºçš„å¤´ï¼Œå°±ä¼šè¢«CORSç­–ç•¥é™åˆ¶ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨è¯·æ±‚å¤´ä¸­åŠ å…¥ <code>x-requested-with</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resp = <span class="keyword">await</span> axios.post(<span class="string">'http://localhost:3000/api/demo'</span>, &#123;&#125;, &#123;</span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæœåŠ¡ç«¯æ²¡æœ‰åšä»»ä½•å¤„ç†ï¼Œæµè§ˆå™¨å°±ä¼šæŠ¥é”™ï¼š</p>
<p><img src="https://s2.ax1x.com/2019/09/11/na33KP.png" alt></p>
<p>åœ¨æœåŠ¡ç«¯å¢åŠ å¤„ç†é¢„æ£€è¯·æ±‚é€»è¾‘ï¼Œå¢åŠ  <code>Access-Control-Allow-Headers</code> å“åº”å¤´ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.options(<span class="string">'*'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.header(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'http://localhost:8080'</span>)</span><br><span class="line">    res.header(<span class="string">'Access-Control-Allow-Headers'</span>, <span class="string">'x-requested-with'</span>);</span><br><span class="line">    res.end(<span class="string">''</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·åœ¨é¢„æ£€è¯·æ±‚é€šè¿‡åï¼Œå‘é€æ­£å¼è¯·æ±‚æ—¶å°±å¯ä»¥æºå¸¦ <code>X-Requested-With</code> è¯·æ±‚å¤´ã€‚</p>
<h2 id="Access-Control-Expose-Headers"><a href="#Access-Control-Expose-Headers" class="headerlink" title="Access-Control-Expose-Headers"></a>Access-Control-Expose-Headers</h2><p>è¿™ä¸ªå“åº”å¤´å’Œ <code>Access-Control-Allow-Headers</code> ç›¸åï¼Œ<code>Access-Control-Allow-Headers</code> è¡¨ç¤ºå®¢æˆ·ç«¯èƒ½æºå¸¦ä»€ä¹ˆè¯·æ±‚å¤´ç»™æœåŠ¡ç«¯ï¼Œ<code>Access-Control-Expose-Headers</code> è¡¨ç¤ºæœåŠ¡ç«¯èƒ½æš´éœ²ä»€ä¹ˆå“åº”å¤´ç»™å®¢æˆ·ç«¯ã€‚æ¯”å¦‚åœ¨æœåŠ¡ç«¯å“åº”æ¥å£æ—¶é€šè¿‡<code>res.header</code>æ·»åŠ äº†è‡ªå®šä¹‰çš„å“åº”å¤´<code>validate-token</code>ï¼Œå¦‚æœæ²¡æœ‰æ·»åŠ  <code>Access-Control-Expose-Headers</code> å¤´ï¼Œå³ä½¿åœ¨æµè§ˆå™¨è°ƒè¯•å·¥å…·é‡Œå¯ä»¥çœ‹åˆ°<code>validate-token</code>ç¡®å®è¢«è¿”å›äº†ï¼Œä½†æ— æ³•é€šè¿‡jsè·å–åˆ°å€¼ã€‚åªæœ‰åœ¨æœåŠ¡ç«¯è®¾ç½®äº†å“åº”å¤´ï¼Œæ‰èƒ½åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­æ‹¿åˆ°å¯¹åº”å“åº”å¤´çš„å€¼ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server</span></span><br><span class="line">app.post(<span class="string">'/api/demo'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.header(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'http://localhost:8080'</span>)</span><br><span class="line">  res.header(<span class="string">'Access-Control-Expose-Headers'</span>, <span class="string">'validate-token'</span>);</span><br><span class="line">  res.header(<span class="string">'validate-token'</span>, <span class="string">'token-value'</span>);</span><br><span class="line">  res.json(&#123;<span class="attr">code</span>: <span class="number">200</span>, <span class="attr">message</span>: <span class="string">'Hello~'</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// client</span></span><br><span class="line"><span class="keyword">const</span> resp = <span class="keyword">await</span> axios.post(<span class="string">'http://localhost:3000/api/demo'</span>, &#123;&#125;, &#123;</span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(resp.headers[<span class="string">'validate-token'</span>]); <span class="comment">// token-value</span></span><br></pre></td></tr></table></figure>
<h2 id="Access-Control-Max-Age"><a href="#Access-Control-Max-Age" class="headerlink" title="Access-Control-Max-Age"></a>Access-Control-Max-Age</h2><p>è¡¨ç¤ºé¢„æ£€è¯·æ±‚çš„è¿”å›ç»“æœï¼ˆå³ Access-Control-Allow-Methods å’ŒAccess-Control-Allow-Headers æä¾›çš„ä¿¡æ¯ï¼‰å¯ä»¥è¢«ç¼“å­˜å¤šä¹…ï¼Œå•ä½æ˜¯ç§’ã€‚åœ¨Firefoxä¸­ï¼Œä¸Šé™æ˜¯24å°æ—¶ ï¼ˆå³86400ç§’ï¼‰ï¼Œè€Œåœ¨Chromium ä¸­åˆ™æ˜¯10åˆ†é’Ÿï¼ˆå³600ç§’ï¼‰ã€‚Chromium åŒæ—¶è§„å®šäº†ä¸€ä¸ªé»˜è®¤å€¼ 5 ç§’ã€‚å¦‚æœå€¼ä¸º -1ï¼Œåˆ™è¡¨ç¤ºç¦ç”¨ç¼“å­˜ã€‚å¦‚æœæ²¡æœ‰ç‰¹æ®Šé€»è¾‘çš„è¯ï¼Œé¢„æ£€è¯·æ±‚åŸºæœ¬éƒ½æ˜¯ç›´æ¥é€šè¿‡ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œè¿™ä¸ªå“åº”å¤´çš„å€¼å¯ä»¥è®¾ç½®å¾—å¤§ä¸€äº›ï¼Œå¦å¤–è‡ªå·±éªŒè¯è¿™ä¸ªå“åº”å¤´çš„åŠŸèƒ½æ—¶è®°å¾—å§ Chrome é‡Œçš„ <code>Disable Cache</code> å…³æ‰ã€‚</p>
<h2 id="Origin"><a href="#Origin" class="headerlink" title="Origin"></a>Origin</h2><p>è¡¨æ˜è·å–èµ„æºçš„è¯·æ±‚æ˜¯ä»ä»€ä¹ˆåŸŸå‘èµ·çš„ã€‚</p>
<h2 id="Access-Control-Allow-Credentials"><a href="#Access-Control-Allow-Credentials" class="headerlink" title="Access-Control-Allow-Credentials"></a>Access-Control-Allow-Credentials</h2><p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å“åº”å¤´ï¼ŒæŒ‡ç¤ºå½“è¯·æ±‚æ˜¯å‡­è¯æ¨¡å¼ï¼ˆRequest.credentials = â€˜includeâ€™ï¼‰æ—¶ï¼Œæ˜¯å¦å“åº”è¯¥è¯·æ±‚ã€‚<br>Credentials å¯ä»¥æ˜¯ cookies, authorization headers æˆ– TLS client certificatesã€‚å…¶ä¸­ Cookie æ˜¯æœ€å¸¸è§çš„ã€‚</p>
<p><code>Access-Control-Allow-Credentials</code> å¤´è¦å’Œ <code>XMLHttpRequest.withCredentials</code> æˆ– <code>Fetch APIä¸­çš„Request()</code> æ„é€ å™¨ä¸­çš„ <code>credentials</code> é€‰é¡¹ç»“åˆä½¿ç”¨ã€‚Credentials å¿…é¡»åœ¨å‰åç«¯éƒ½è¢«é…ç½®ï¼ˆå³the Access-Control-Allow-Credentials header å’Œ XHR æˆ–Fetch requestä¸­éƒ½è¦é…ç½®ï¼‰æ‰èƒ½ä½¿å¸¦ <code>credentials</code> çš„CORSè¯·æ±‚æˆåŠŸã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæƒ³åœ¨è·¨åŸŸè¯·æ±‚å¸¦ä¸Š Cookieï¼Œä»¥ <code>axios</code> ä¸ºä¾‹ï¼Œå®¢æˆ·ç«¯é¦–å…ˆè¦è®¾ç½® <code>withCredentials: true</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resp = <span class="keyword">await</span> axios.post(<span class="string">'http://localhost:3000/api/demo'</span>, &#123;&#125;, &#123;</span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    withCredentials: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶ï¼ŒæœåŠ¡ç«¯ä¹Ÿè¦è®¾ç½® <code>Access-Control-Allow-Credentials</code>ï¼Œè¿™é‡Œ options å’Œ æ­£å¼è¯·æ±‚éƒ½è¦è®¾ç½®ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.options(<span class="string">'*'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.header(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'http://localhost:8080'</span>);</span><br><span class="line">    res.header(<span class="string">'Access-Control-Max-Age'</span>, <span class="number">60</span>);</span><br><span class="line">    res.header(<span class="string">'Access-Control-Allow-Headers'</span>, <span class="string">'content-type,x-requested-with'</span>);</span><br><span class="line">    res.header(<span class="string">'Access-Control-Expose-Headers'</span>, <span class="string">'validate-token'</span>);</span><br><span class="line">    res.header(<span class="string">'Access-Control-Allow-Credentials'</span>, <span class="literal">true</span>);</span><br><span class="line">    res.end(<span class="string">''</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/api/demo'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'[COOKIE]'</span>, req.headers.cookie)</span><br><span class="line">    res.header(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'http://localhost:8080'</span>)</span><br><span class="line">    res.header(<span class="string">'Access-Control-Expose-Headers'</span>, <span class="string">'validate-token'</span>);</span><br><span class="line">    res.header(<span class="string">'validate-token'</span>, <span class="string">'token-value'</span>);</span><br><span class="line">    res.header(<span class="string">'Access-Control-Allow-Credentials'</span>, <span class="literal">true</span>);</span><br><span class="line">    res.json(&#123;<span class="attr">code</span>: <span class="number">200</span>, <span class="attr">message</span>: <span class="string">'Hello~'</span>&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>åˆ·æ–°æµè§ˆå™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å°±èƒ½åœ¨è·¨åŸŸçš„æƒ…å†µåŠ æ¥æ”¶åˆ° Cookieï¼š</p>
<p><img src="https://s2.ax1x.com/2019/09/12/nwI0lF.png" alt></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>CORS</code>æ˜¯é€šè¿‡ä¼ è¾“çš„HTTPå¤´ç»„æˆçš„ä¸€ä¸ªç³»ç»Ÿï¼Œç”¨æ¥å†³å®šæµè§ˆå™¨æ˜¯å¦è¦é˜»æ­¢è·¨åŸŸè¯·æ±‚çš„å“åº”ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªéœ€è¦è®¾ç½® <code>Access-Control-Allow-Origin</code> å°±èƒ½è§£å†³ä¸€å¤§åŠçš„åœºæ™¯ï¼›å¦‚æœéœ€è¦æºå¸¦è‡ªå®šä¹‰çš„è¯·æ±‚å¤´ï¼Œå“åº”å¤´ï¼Œå°±è¦ç”¨åˆ° <code>Access-Control-Allow-Headers</code> å’Œ <code>Access-Control-Expose-Headers</code> äº†ï¼›<code>Access-Control-Request-Header</code> å’Œ <code>Access-Control-Request-Method</code>ï¼Œ<code>Origin</code> æ— éœ€è®¾ç½®ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¸¦ä¸Šï¼Œåœ¨è¿›è¡Œè‡ªå®šä¹‰æ ¡éªŒæ—¶å¯èƒ½ä¼šæ´¾ä¸Šç”¨åœºï¼›å¦‚æœæƒ³è¦åœ¨è·¨åŸŸè¯·æ±‚å¤´æºå¸¦è®¤è¯ä¿¡æ¯ï¼Œå°±ä¸€å®šè¦è®¾ç½® <code>Access-Control-Allow-Credentials</code> å“åº”å¤´ï¼Œå®¢æˆ·ç«¯ä¹Ÿè¦å¯ç”¨è®¤è¯æ¨¡å¼ã€‚</p>
<p>è·¨åŸŸçš„é—®é¢˜è¿˜æ˜¯å¾ˆå¥½è§£å†³çš„ï¼Œå› ä¸ºå½“JSä»£ç å› ä¸ºåŒæºç­–ç•¥è¢«é˜»å¡æ—¶ï¼Œæµè§ˆå™¨ç»™å‡ºçš„é”™è¯¯æç¤ºå·²ç»è¶³å¤Ÿè¯¦ç»†äº†ï¼Œåªè¦æ ¹æ®é”™è¯¯ä¿¡æ¯ä¿®æ”¹å¤´ä¿¡æ¯å°±èƒ½ä¸‡äº‹å¤§å‰äº†~</p>

    </section>
    
        <section id="comments">
        
        </section>
    
</article>

    </div>
    <button class="feedback-btn" data-feedbackok-trigger>Hello~ ğŸ¥°</button>
    <footer>
    <div class="info"><span>Powered By <a href="https://hexo.io/" target="blank">Hexo</a></span>&nbsp;&nbsp;&nbsp;&nbsp;<span>Theme by <a href="https://github.com/showonne/hexo_showonne" target="blank">Showonne</a></span></div>
</footer>
    <script src="https://cdn.feedbackok.com/widget.js" data-pid="0m524p3" async defer></script>
    <script src="/js/index.js"></script>
</body>
</html>
